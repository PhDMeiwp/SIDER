{
    "contents" : "########################################################################################################\n########################################### all #############################################\n########################################################################################################\nrm(list=ls())\n\nif(!require(devtools)) install.packages(\"devtools\")\ninstall_github(\"healyke/Fester\", ref = \"master\")\ninstall_github(\"TGuillerme/mulTree\", ref = \"master\")\nlibrary(mulTree)\nlibrary(FestR)\n\n\n\n#read in the data\nmydata<-read.csv(file=system.file(\"extdata\", \"FestR_data.csv\", package = \"FestR\"),\n                 header=T, stringsAsFactors = F)\n\n# re-order it into species\nmydata <- mydata[order(mydata$species),]\n\n###maybe I need to fix the data up.\n\n\n# ----------------------------------------------------------------\n#read in the two trees\n# These two are the original as bundled with FestR\nmammal.trees <- read.tree(system.file(\"extdata\", \"3firstFritzTrees.tre\", package = \"FestR\"))\nbird.trees   <- read.tree(system.file(\"extdata\", \"3firstJetzTrees.tre\", package = \"FestR\"))\n\n# TG: I just created a subsample of the BIG trees (all sp) to make it faster\n#combine them together\ncombined.trees <- tree.bindÂ (x = mammal.trees, y = bird.trees, sample = 3, root.age = 250)\n\nprior_tef <- list(R = list(V = 1/4, nu=0.002), G = list(G1=list(V = 1/4, nu=0.002),\n\t\t\t\t\tG2=list(V = 1/4, nu=0.002), G3=list(V = 1/4, nu=0.002)))\n\n\n#clean up data \ntef.aves.data.n <- tefMulClean(data = mydata, species_col_name = \"species\", trees =  combined.trees, taxonomic.class = \"aves\", isotope = \"nitrogen\")\ntef.aves.data.c <- tefMulClean(data = mydata, species_col_name = \"species\", trees =  combined.trees, taxonomic.class = \"aves\", isotope = \"carbon\")\n\ntef.mam.data.n <- tefMulClean(data = mydata, species_col_name = \"species\", trees =  combined.trees, taxonomic.class = \"mammalia\", isotope = \"nitrogen\")\ntef.mam.data.c <- tefMulClean(data = mydata, species_col_name = \"species\", trees =  combined.trees, taxonomic.class = \"mammalia\", isotope = \"carbon\")\n\n\n\n\n#set the forumula\nformula.n <- delta15N ~ source.iso.15N + diet.type + habitat\nformula.c <- delta13C ~ source.iso.13C + diet.type + habitat\n\nformula.n_noiso <- delta15N ~  diet.type + habitat\nformula.c_coiso <- delta13C ~  diet.type + habitat\n\nrandom <- ~ animal + sp.col + tissue\n\n######################################## calculate the indavidual removal #############################################\n\naves.nitrogen.ind <- individual_replace(tef_data = tef.aves.data.n, isotope = \"nitrogen\", formula = formula.n, random = random, prior = prior_tef, output.label = \"aves_n\")\naves.nitrogen.ind.noiso <- individual_replace(tef_data = tef.aves.data.n, isotope = \"nitrogen\", formula = formula.n_noiso, random = random, prior = prior_tef, output.label = \"aves_n_noiso\", nitt = c(1200000),  thin = c(500),  burnin = c(200000), no.chains = c(2), convergence =  c(1.1), ESS = c(1000))\n\n\naves.carbon.ind <- individual_replace(tef_data = tef.aves.data.c, isotope = \"carbon\", formula = formula.n, random = random, prior = prior_tef, output.label = \"aves_c\")\naves.carbon.ind.noiso <- individual_replace(tef_data = tef.aves.data.c, isotope = \"carbon\", formula = formula.c_noiso, random = random, prior = prior_tef, output.label = \"aves_c_noiso\", nitt = c(1200000),  thin = c(500),  burnin = c(200000), no.chains = c(2), convergence =  c(1.1), ESS = c(1000))\n\n\n\nmammal.nitrogen.ind <- individual_replace(tef_data = tef.mam.data.n, isotope = \"nitrogen\", formula = formula.n, random = random, prior = prior_tef, output.label = \"mam_n\" )\nmammal.nitrogen.ind.noiso <- individual_replace(tef_data = tef.mam.data.n, isotope = \"nitrogen\", formula = formula.n_noiso, random = random, prior = prior_tef, output.label = \"mam_n_noiso\" , nitt = c(1200000),  thin = c(500),  burnin = c(200000), no.chains = c(2), convergence =  c(1.1), ESS = c(1000))\n\n\n\nmammal.carbon.ind <- individual_replace(tef_data = tef.mam.data.c, isotope = \"carbon\", formula = formula.c, random = random, prior = prior_tef, output.label = \"mam_c\")\nmammal.carbon.ind.noiso <- individual_replace(tef_data = tef.mam.data.c, isotope = \"nitrogen\", formula = formula.c_noiso, random = random, prior = prior_tef, output.label = \"mam_c_noiso\", nitt = c(1200000),  thin = c(500),  burnin = c(200000), no.chains = c(2), convergence =  c(1.1), ESS = c(1000) )\n\n\n\n######################################## calculate the species removal #############################################\n\n\n\naves.nitrogen.species <- species_replace(tef_data = tef.aves.data.n, isotope = \"nitrogen\", formula = formula.n, random = random, prior = prior_tef, output.label = \"aves_n\")\naves.nitrogen.species.noiso <- species_replace(tef_data = tef.aves.data.n, isotope = \"nitrogen\", formula = formula.n_noiso, random = random, prior = prior_tef, output.label = \"aves_n_noiso\", nitt = c(2400000),  thin = c(1000),  burnin = c(400000), no.chains = c(2), convergence =  c(1.1), ESS = c(1000))\n\n\naves.carbon.species <- species_replace(tef_data = tef.aves.data.c, isotope = \"carbon\", formula = formula.n, random = random, prior = prior_tef, output.label = \"aves_c\")\naves.carbon.species.noiso <- species_replace(tef_data = tef.aves.data.c, isotope = \"carbon\", formula = formula.c_noiso, random = random, prior = prior_tef, output.label = \"aves_c_noiso\", nitt = c(2400000),  thin = c(1000),  burnin = c(400000), no.chains = c(2), convergence =  c(1.1), ESS = c(1000))\n\n\n\nmammal.nitrogen.species <- species_replace(tef_data = tef.mam.data.n, isotope = \"nitrogen\", formula = formula.n, random = random, prior = prior_tef, output.label = \"mam_n\")\nmammal.nitrogen.species.noiso <- species_replace(tef_data = tef.mam.data.n, isotope = \"nitrogen\", formula = formula.n_noiso, random = random, prior = prior_tef, output.label = \"mam_n_noiso\", nitt = c(2400000),  thin = c(1000),  burnin = c(400000), no.chains = c(2), convergence =  c(1.1), ESS = c(1000))\n\n\n\nmammal.carbon.species <- species_replace(tef_data = tef.mam.data.c, isotope = \"carbon\", formula = formula.n, random = random, prior = prior_tef, output.label = \"mam_c\")\nmammal.carbon.species.noiso <- species_replace(tef_data = tef.mam.data.c, isotope = \"carbon\", formula = formula.c_noiso, random = random, prior = prior_tef, output.label = \"mam_c_noiso\", nitt = c(2400000),  thin = c(1000),  burnin = c(400000), no.chains = c(2), convergence =  c(1.1), ESS = c(1000))\n\n\n###if data needs to be read back in.\n\naves_c_spc <- read_tef(chain.name = \"aves_c_spe\", Tef.data = c(tef.aves.data.c), no.trees = c(10), no.chains = c(2))\naves_c_ind <- read_tef(chain.name = \"aves_c_ind\", Tef.data = c(tef.aves.data.c), no.trees = c(3), no.chains = c(2))\n\n\nmam_c_spc <- read_tef(chain.name = \"mam_c_spe\", Tef.data = c(tef.mam.data.c), no.trees = c(10), no.chains = c(2))\nmam_c_ind <- read_tef(chain.name = \"mam_c_ind\", Tef.data = c(tef.mam.data.c), no.trees = c(3), no.chains = c(2))\n\n\naves_n_spc <- read_tef(chain.name = \"aves_n_spe\", Tef.data = c(tef.aves.data.n), no.trees = c(10), no.chains = c(2))\naves_n_ind <- read_tef(chain.name = \"aves_n_ind\", Tef.data = c(tef.aves.data.n), no.trees = c(10), no.chains = c(2))\n\n\nmam_n_spc <- read_tef(chain.name = \"mam_n_spe\", Tef.data = c(tef.mam.data.n), no.trees = c(10), no.chains = c(2))\nmam_n_ind <- read_tef(chain.name = \"mam_n_ind\", Tef.data = c(tef.mam.data.n), no.trees = c(3), no.chains = c(2))\n\n\n\n\n\n###Plots\nTef_plot(tef_data = tef.aves.data.c, ind.output = aves_c_ind, spc.output = aves_c_spc, title.main = c('Aves Nitrogen TEF'), xlim = c(0,8))\n\naves_c_ind_diff <- compare_tef(Tef.data = tef.aves.data.c, isotope = \"carbon\", Tef.output = aves_c_ind)\naves_c_spc_diff <- compare_tef(Tef.data = tef.aves.data.c, isotope = \"carbon\", Tef.output = aves_c_spc)\n\naves_n_ind_diff <- compare_tef(Tef.data = tef.aves.data.n, isotope = \"nitrogen\", Tef.output = aves_n_ind)\naves_n_spc_diff <- compare_tef(Tef.data = tef.aves.data.n, isotope = \"nitrogen\", Tef.output = aves_n_spc)\n\n\nmam_c_ind_diff <- compare_tef(Tef.data = tef.mam.data.c, isotope = \"carbon\", Tef.output = mam_c_ind)\nmam_c_spc_diff <- compare_tef(Tef.data = tef.mam.data.c, isotope = \"carbon\", Tef.output = mam_c_spc)\n\nmam_n_ind_diff <- compare_tef(Tef.data = tef.mam.data.n, isotope = \"nitrogen\", Tef.output = mam_n_ind)\nmam_n_spc_diff <- compare_tef(Tef.data = tef.mam.data.n, isotope = \"nitrogen\", Tef.output = mam_n_spc)\n\n\n\nTef.hist.plot( diff.mam.ind.c = mam_c_ind_diff,\n               diff.mam.ind.n = mam_n_ind_diff,\n               diff.aves.ind.c = aves_c_ind_diff,\n               diff.aves.ind.n = aves_n_ind_diff,\n               diff.mam.spc.c = mam_c_spc_diff,\n               diff.mam.spc.n = mam_n_spc_diff,\n               diff.aves.spc.c = aves_c_spc_diff,\n               diff.aves.spc.n = aves_n_spc_diff,\n               type = \"full\")\n\n#\nhdr.den(c(unlist(mam_n_spc_diff$diff_mean),unlist(aves_c_spc_diff$diff_mean),unlist(aves_n_spc_diff$diff_mean), unlist(mam_c_spc_diff$diff_mean)))\nhdr.den(c(unlist(mam_n_ind_diff$diff_mean),unlist(aves_c_ind_diff$diff_mean),unlist(aves_n_ind_diff$diff_mean), unlist(mam_c_ind_diff$diff_mean)))\n\n",
    "created" : 1457785930320.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2502377974",
    "id" : "B67461AE",
    "lastKnownWriteTime" : 1459267178,
    "path" : "~/Desktop/FestR_replacement_tests/Full-replacment_test.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}